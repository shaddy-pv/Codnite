<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codnite Authentication Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
        .success { background: #155724; border: 1px solid #c3e6cb; padding: 15px; border-radius: 4px; }
        .error { background: #721c24; border: 1px solid #f5c6cb; padding: 15px; border-radius: 4px; }
        .info { background: #0c5460; border: 1px solid #bee5eb; padding: 15px; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .debug { background: #333; border: 1px solid #666; font-family: monospace; font-size: 12px; padding: 15px; border-radius: 4px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Codnite Authentication Test</h1>
        
        <div class="test-section">
            <h2>‚úÖ Changes Made</h2>
            <div class="success">
                1. ‚úÖ CORS issue fixed - Backend now allows localhost:5173<br>
                2. ‚úÖ App now shows LOGIN form by default (instead of registration)<br>
                3. ‚úÖ Enhanced debug logging for authentication flow<br>
                4. ‚úÖ Better error handling and state management
            </div>
        </div>
        
        <div class="test-section">
            <h2>üß™ Test Instructions</h2>
            <div class="info">
                <strong>Step 1:</strong> Open your Codnite app at <a href="http://localhost:5173" target="_blank" style="color: #007bff;">http://localhost:5173</a><br><br>
                <strong>Step 2:</strong> You should now see the LOGIN form by default (not registration)<br><br>
                <strong>Step 3:</strong> Use these credentials to test:<br>
                ‚Ä¢ <strong>Email:</strong> shadan@example.com<br>
                ‚Ä¢ <strong>Password:</strong> Shadan700@#<br><br>
                <strong>Step 4:</strong> Click "Sign In" and check the console logs
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîç What to Look For</h2>
            <div class="info">
                <strong>In Browser Console:</strong><br>
                ‚Ä¢ "Login form submitted"<br>
                ‚Ä¢ "Form validation passed, starting login..."<br>
                ‚Ä¢ "Login API response received: [data]"<br>
                ‚Ä¢ "Valid response, storing token and calling onLogin..."<br>
                ‚Ä¢ "handleLogin called with: [userData]"<br>
                ‚Ä¢ "Login completed successfully"<br><br>
                <strong>Expected Result:</strong><br>
                ‚Ä¢ No CORS errors<br>
                ‚Ä¢ Successful login<br>
                ‚Ä¢ Redirect to main dashboard (not back to registration)
            </div>
        </div>
        
        <div class="test-section">
            <h2>üö® If Still Not Working</h2>
            <div class="error">
                If you still have issues:<br><br>
                1. <strong>Clear browser data:</strong> Clear localStorage and cookies<br>
                2. <strong>Check console:</strong> Look for any error messages<br>
                3. <strong>Try incognito mode:</strong> Test in a private browsing window<br>
                4. <strong>Share console logs:</strong> Copy any error messages you see
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìã Quick Actions</h2>
            <button onclick="openMainApp()">Open Codnite App</button>
            <button onclick="clearStorage()">Clear Browser Storage</button>
            <button onclick="testAPI()">Test API Directly</button>
        </div>
        
        <div class="test-section">
            <h2>üîç Debug Information</h2>
            <div id="debugInfo" class="debug">Loading debug info...</div>
        </div>
    </div>

    <script>
        function openMainApp() {
            window.open('http://localhost:5173', '_blank');
        }
        
        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            alert('Browser storage cleared! Please refresh the page.');
        }
        
        async function testAPI() {
            try {
                const response = await fetch('http://localhost:5000/api/health');
                const data = await response.text();
                alert(`API Test: ${response.status} - ${data}`);
            } catch (error) {
                alert(`API Test Failed: ${error.message}`);
            }
        }
        
        function updateDebugInfo() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            let debug = 'Debug Information:\n\n';
            debug += `Backend Status: http://localhost:5000/api/health\n`;
            debug += `Token: ${token ? 'EXISTS (' + token.substring(0, 30) + '...)' : 'NONE'}\n`;
            debug += `User: ${user ? 'EXISTS' : 'NONE'}\n`;
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    debug += `User Name: ${userData.name}\n`;
                    debug += `User Email: ${userData.email}\n`;
                } catch (e) {
                    debug += `User Parse Error: ${e.message}\n`;
                }
            }
            
            debug += `\nCurrent Time: ${new Date().toLocaleString()}\n`;
            debug += `App URL: http://localhost:5173\n`;
            debug += `API URL: http://localhost:5000/api\n`;
            
            document.getElementById('debugInfo').innerHTML = debug;
        }
        
        // Initial debug info
        updateDebugInfo();
        setInterval(updateDebugInfo, 2000);
    </script>
</body>
</html>
